# 智能测试数据生成系统

这是一个基于算法的智能测试数据生成系统，为慢性疾病应用后端提供真实、多样化的测试数据。

## 🎯 系统特点

### ✨ 智能算法驱动
- **个性化数据生成**: 基于患者年龄、性别、健康状况等特征动态生成数据
- **生理学原理**: 考虑昼夜节律、季节性影响、压力因素等真实生理现象
- **疾病风险评估**: 动态计算各种疾病风险，生成相应的健康指标
- **无固定模式**: 每次运行都会产生不同的、更真实的测试数据

### 🔬 科学的数据模型
- **血压数据**: 考虑年龄、性别、疾病风险、压力、昼夜变化、季节性影响
- **心率数据**: 基于年龄、活动水平、压力、昼夜节律
- **体重数据**: 考虑长期趋势、活动水平、季节性变化
- **血糖数据**: 基于疾病风险、餐后时间、活动水平、压力因素

## 📁 文件结构

```
survey_data_preparation/
├── unified_test_data_manager.py    # 统一测试数据管理器（主要脚本）
└── README.md                       # 本说明文档

chronic-disease-backend/
├── health/management/commands/
│   └── create_test_data.py        # Django管理命令：智能健康数据生成
└── manage.py                       # Django管理脚本
```

## 🚀 快速开始

### 1. 一键完整设置（推荐）
```bash
cd chronic-disease-backend
python survey_data_preparation/unified_test_data_manager.py
```
这将自动执行：
- 清除数据库
- 创建完整用户（3医生+8患者）
- 生成智能健康数据（30天）
- 运行智能告警分析
- 设置5级风险评估系统
- 验证数据完整性

### 2. 分步执行
```bash
# 步骤1: 创建用户
python survey_data_preparation/unified_test_data_manager.py full

# 步骤2: 生成健康数据
python manage.py create_test_data --days 30

# 步骤3: 运行智能分析
python survey_data_preparation/unified_test_data_manager.py analyze
```

## 🎨 智能数据生成算法

### 患者特征分析
```python
# 动态计算患者特征
- 基础健康水平: 基于年龄、性别
- 压力水平: 考虑年龄相关压力因素
- 活动水平: 基于年龄和随机因素
- 疾病风险: 动态计算各种疾病风险
- 季节性影响: 考虑冬夏春秋的健康影响
```

### 数据生成示例
```python
# 血压生成算法
base_systolic = 110 + (age - 30) * 0.5
+ 疾病风险影响 (高血压风险 > 0.6 时 +20)
+ 压力影响 (压力水平 * 15)
+ 昼夜变化 (早晨/晚上 +10, 其他时间 -5)
+ 季节性影响 (冬季 +5, 夏季 -3)
+ 随机波动 (-8 到 +8)

# 心率生成算法
base_hr = 80 - (age - 30) * 0.3
+ 活动水平影响 ((1 - 活动水平) * 20)
+ 压力影响 (压力水平 * 15)
+ 昼夜变化 (早晨 +10, 夜间 -15)
+ 随机波动 (-10 到 +10)
```

## 📊 生成的数据类型

### 健康指标
- **血压**: 收缩压/舒张压，考虑昼夜和季节性变化
- **心率**: 基于活动和压力水平
- **体重**: 长期趋势 + 短期波动
- **血糖**: 餐后影响 + 疾病风险

### 数据量
- 每个患者每天生成 4 种健康指标
- 默认生成 30 天数据
- 8个患者 × 4种指标 × 30天 = 960条健康记录

## 🔧 使用方法

### 交互式模式
```bash
python survey_data_preparation/unified_test_data_manager.py
```

### 命令行模式

#### 基础数据管理
```bash
# 查看状态
python unified_test_data_manager.py status

# 清除数据库
python unified_test_data_manager.py clear

# 创建用户
python unified_test_data_manager.py basic      # 3医生+3患者
python unified_test_data_manager.py full       # 3医生+8患者
```

#### 智能数据生成
```bash
# 使用Django管理命令生成数据
python manage.py create_test_data --days 30           # 生成30天数据
python manage.py create_test_data --days 7 --patients 1  # 为1个患者生成7天数据

# 运行智能分析
python unified_test_data_manager.py analyze
```

#### 高级功能
```bash
# 设置5级风险系统
python unified_test_data_manager.py risk5

# 验证数据完整性
python unified_test_data_manager.py validate

# 导出数据
python unified_test_data_manager.py export json
python unified_test_data_manager.py export csv
```

## 📋 测试账号

### 医生账号
- **李医生**: +8613800138001 / test123456
- **王医生**: +8613800138021 / test123456  
- **张医生**: +8613800138022 / test123456

### 患者账号
- **张三**: +8613800138000 / test123456
- **李四**: +8613800138002 / test123456
- **王五**: +8613800138003 / test123456
- **赵六**: +8613800138004 / test123456
- **刘七**: +8613800138005 / test123456
- **陈八**: +8613800138006 / test123456
- **孙九**: +8613800138007 / test123456
- **周十**: +8613800138008 / test123456

## 🎯 5级风险评估系统

系统自动设置5种风险状态：

1. **未评估** (unassessed): 医生尚未评估
2. **健康** (healthy): 无慢性疾病
3. **低风险** (low): 关节炎、偏头痛等
4. **中风险** (medium): 糖尿病、高血压等
5. **高风险** (high): 癌症、心脏病等

## 🔬 技术架构

### 核心组件
- **患者特征分析器**: 动态分析患者特征
- **健康数据生成器**: 基于算法生成个性化数据
- **季节性因子计算器**: 考虑季节对健康的影响
- **疾病风险评估器**: 动态计算疾病风险

### 算法特性
- **个性化**: 每个患者都有独特的健康模式
- **真实性**: 基于生理学原理的数据生成
- **多样性**: 每次运行产生不同的数据
- **关联性**: 不同健康指标之间有合理的关联

## 📈 数据质量保证

### 数据范围控制
- 血压: 收缩压 90-200 mmHg, 舒张压 60-120 mmHg
- 心率: 45-120 bpm
- 体重: 40-120 kg
- 血糖: 3.5-15.0 mmol/L

### 生理合理性
- 昼夜节律: 早晨血压和心率较高
- 季节性影响: 冬季血压略高，夏季活动增加
- 年龄相关性: 年龄越大，基础血压和心率略有变化
- 压力影响: 压力增加时血压和心率上升

## ⚠️ 注意事项

1. **环境要求**: 确保Django环境已正确配置
2. **数据库权限**: 确保有足够的数据库操作权限
3. **数据安全**: 清除数据库操作不可逆，请谨慎使用
4. **备份建议**: 重要数据请提前备份

## 🆘 常见问题

### Q: 运行时报错"ModuleNotFoundError"
A: 确保在 `chronic-disease-backend` 目录下运行

### Q: 数据库连接失败
A: 检查Django设置文件中的数据库配置

### Q: 5级风险系统设置失败
A: 确保先创建了足够的患者用户（至少5个）

### Q: 数据生成速度慢
A: 这是正常现象，算法需要为每个患者计算个性化参数

## 🎉 系统优势

1. **真实性强**: 基于生理学原理，数据更接近真实情况
2. **个性化**: 每个患者都有独特的健康模式
3. **智能化**: 自动分析患者特征，生成相应数据
4. **可扩展**: 易于添加新的健康指标和算法
5. **一致性**: 数据之间有合理的医学关联性

## 📞 技术支持

如有问题，请检查：
1. Django环境配置
2. 数据库连接状态
3. 模型字段定义
4. 依赖包安装情况

---

**注意**: 本系统生成的是测试数据，不应用于临床诊断或医疗决策。
