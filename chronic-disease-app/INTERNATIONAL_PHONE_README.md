# 🌍 国际化手机号功能

## 概述

慢性病管理系统现在支持国际化手机号码注册，允许来自不同国家/地区的用户使用其本地手机号码格式进行注册。

## ✨ 功能特性

### 🔧 前端功能
- **国家区号选择器**：用户可以选择不同的国家/地区
- **动态输入验证**：根据所选国家自动调整输入格式和长度限制
- **实时格式提示**：显示当前国家的手机号格式示例
- **智能输入清理**：切换国家时自动清空输入框，避免格式冲突

### 🛡️ 后端验证
- **格式验证**：确保手机号包含正确的国家区号
- **长度验证**：验证手机号长度在合理范围内（7-15位）
- **唯一性验证**：确保每个手机号只能注册一次
- **字符验证**：只允许数字和+号

## 🌐 支持的国家/地区

| 国家/地区 | 区号 | 手机号长度 | 示例 |
|-----------|------|------------|------|
| 🇨🇳 中国 | +86 | 11位 | 13800138000 |
| 🇺🇸 美国 | +1 | 10位 | 2025551234 |
| 🇨🇦 加拿大 | +1 | 10位 | 4165551234 |
| 🇬🇧 英国 | +44 | 10位 | 7700123456 |
| 🇫🇷 法国 | +33 | 9位 | 123456789 |
| 🇩🇪 德国 | +49 | 11位 | 17012345678 |
| 🇯🇵 日本 | +81 | 11位 | 09012345678 |
| 🇰🇷 韩国 | +82 | 11位 | 01012345678 |
| 🇸🇬 新加坡 | +65 | 8位 | 81234567 |
| 🇲🇾 马来西亚 | +60 | 10位 | 1234567890 |
| 🇹🇭 泰国 | +66 | 9位 | 812345678 |
| 🇮🇳 印度 | +91 | 10位 | 9876543210 |
| 🇦🇺 澳大利亚 | +61 | 9位 | 412345678 |
| 🇳🇿 新西兰 | +64 | 9位 | 212345678 |
| 🇧🇷 巴西 | +55 | 11位 | 11987654321 |
| 🇷🇺 俄罗斯 | +7 | 10位 | 9123456789 |

## 🚀 使用方法

### 用户注册流程

1. **选择国家/地区**
   - 点击区号选择器
   - 使用搜索功能快速找到目标国家
   - 选择合适的国家/地区

2. **输入手机号**
   - 按照显示的格式示例输入手机号
   - 系统会自动验证格式和长度
   - 看到绿色提示表示格式正确

3. **完成注册**
   - 填写其他必要信息
   - 提交注册表单
   - 系统会存储完整的国际化手机号（包含区号）

### 开发者使用

#### 前端组件使用

```javascript
import CountryCodePicker from '../components/CountryCodePicker';
import { DEFAULT_COUNTRY, validatePhoneNumber } from '../utils/countryCodes';

// 在组件中使用
<CountryCodePicker
  selectedCountry={selectedCountry}
  onCountrySelect={(country) => {
    setSelectedCountry(country);
    // 处理国家变更
  }}
/>
```

#### 后端API格式

```json
{
  "name": "张三",
  "email": "zhangsan@example.com",
  "phone": "+8613800138000",
  "password": "password123",
  "role": "patient",
  "age": 30,
  "gender": "male"
}
```

## 📁 相关文件

### 前端文件
- `src/utils/countryCodes.js` - 国家区号数据和验证函数
- `src/components/CountryCodePicker.js` - 国家区号选择组件
- `src/screens/auth/RegisterScreen.js` - 注册页面（已更新）

### 后端文件
- `accounts/serializers.py` - 用户注册序列化器（已更新验证）
- `accounts/models.py` - 用户模型（phone字段支持20字符）

## 🧪 测试

运行测试脚本来验证功能：

```bash
# 在后端目录中运行
cd chronic-disease-backend
python test_international_phone.py
```

测试内容包括：
- 各国手机号格式验证
- 无效格式拒绝
- 手机号唯一性验证

## 🔧 技术实现

### 前端实现
- **React State管理**：使用`useState`管理选择的国家
- **动态验证**：根据国家配置动态调整验证规则
- **模态框选择**：使用Modal组件实现国家选择界面
- **搜索功能**：支持按国家名称和区号搜索

### 后端实现
- **Django序列化器验证**：在`UserRegistrationSerializer`中添加phone字段验证
- **格式检查**：验证区号格式和数字组成
- **唯一性约束**：确保手机号在数据库中唯一
- **错误处理**：提供清晰的错误消息

## 🎯 未来扩展

### 计划功能
1. **SMS验证**：添加手机号验证码功能
2. **更多国家**：扩展支持更多国家/地区
3. **自动检测**：根据用户位置自动选择国家
4. **号码格式化**：显示时自动格式化手机号

### 配置扩展
如需添加新的国家/地区，请在`countryCodes.js`中添加相应配置：

```javascript
{
  code: '+xxx',
  country: '国家名称',
  flag: '🏳️',
  phoneLength: 10,
  phoneRegex: /^[0-9]{10}$/,
  placeholder: '请输入手机号码',
  example: '1234567890'
}
```

## 🐛 问题反馈

如果您发现任何问题或有改进建议，请：

1. 检查是否已在支持的国家列表中
2. 确认手机号格式是否正确
3. 查看浏览器控制台是否有错误信息
4. 联系开发团队获取支持

## 📝 更新日志

### v1.0.0 (2024-01-08)
- ✨ 添加国际化手机号支持
- 🔧 创建国家区号选择器组件
- 🛡️ 实现前后端验证
- 📚 添加完整文档和测试

---

*该功能让慢性病管理系统能够服务全球用户，提供更好的国际化体验。* 