# 聊天功能测试指南

## 功能概述

慢性疾病管理系统的聊天功能支持医生和患者之间的实时沟通，包括：
- 实时消息收发
- 会话管理
- 用户搜索
- 消息状态管理
- 角色权限控制

## 测试环境准备

### 1. 启动后端服务

```bash
cd chronic-disease-backend
python manage.py runserver
```

### 2. 启动前端应用

```bash
cd chronic-disease-app
npm start
```

### 3. 测试用户账户

**医生账户**：
- 手机号：+86 138-0013-8001
- 密码：123456
- 角色：医生

**患者账户**：
- 手机号：+86 138-0013-8000
- 密码：123456
- 角色：患者

## 测试流程

### 第一阶段：基本功能测试

#### 1. 患者端测试

1. **登录患者账户**
   - 使用 +86 138-0013-8000 登录
   - 验证登录成功

2. **进入消息界面**
   - 点击底部导航栏的"消息"选项
   - 验证进入会话列表界面

3. **开始新聊天**
   - 点击右上角的"+"按钮
   - 验证进入用户搜索界面

4. **搜索医生**
   - 在搜索框中输入医生姓名或手机号
   - 验证搜索结果显示医生信息
   - 点击医生头像开始聊天

5. **发送消息**
   - 在聊天界面输入消息内容
   - 点击发送按钮
   - 验证消息发送成功并显示在聊天界面

#### 2. 医生端测试

1. **登录医生账户**
   - 使用 +86 138-0013-8001 登录
   - 验证登录成功

2. **进入消息界面**
   - 点击底部导航栏的"消息"选项
   - 验证能看到与患者的会话

3. **查看患者消息**
   - 点击与患者的会话
   - 验证能看到患者发送的消息

4. **回复患者**
   - 在聊天界面输入回复内容
   - 点击发送按钮
   - 验证消息发送成功

### 第二阶段：功能完整性测试

#### 1. 会话管理测试

1. **会话创建**
   - 验证新会话自动创建
   - 检查会话标题是否正确
   - 验证会话参与者设置

2. **会话列表**
   - 验证会话按时间排序
   - 检查最新消息预览
   - 验证未读消息数量显示

3. **会话状态**
   - 验证已读/未读状态
   - 检查消息时间显示
   - 验证消息发送者标识

#### 2. 消息管理测试

1. **消息发送**
   - 测试文本消息发送
   - 验证消息发送状态
   - 检查消息时间戳

2. **消息接收**
   - 验证实时消息接收
   - 检查消息排序
   - 验证消息格式

3. **消息分页**
   - 发送多条消息
   - 验证分页加载
   - 检查历史消息获取

#### 3. 权限控制测试

1. **角色权限**
   - 患者只能与医生聊天
   - 医生可以与患者聊天
   - 验证权限控制生效

2. **数据访问**
   - 用户只能访问自己的会话
   - 验证消息隐私保护
   - 检查未授权访问拦截

### 第三阶段：用户体验测试

#### 1. 界面交互测试

1. **聊天界面**
   - 验证消息气泡样式
   - 检查发送者标识
   - 验证时间显示格式

2. **用户搜索**
   - 测试搜索功能
   - 验证搜索结果准确性
   - 检查搜索响应速度

3. **导航流畅性**
   - 验证页面跳转流畅
   - 检查返回按钮功能
   - 验证导航逻辑正确

#### 2. 错误处理测试

1. **网络错误**
   - 断网情况下的处理
   - 网络恢复后的重连
   - 错误提示是否友好

2. **数据异常**
   - 空消息处理
   - 超长消息处理
   - 特殊字符处理

3. **权限异常**
   - 未登录状态处理
   - 权限不足提示
   - 会话过期处理

## 测试检查清单

### 基本功能 ✅
- [ ] 用户登录/注册
- [ ] 会话创建
- [ ] 消息发送
- [ ] 消息接收
- [ ] 用户搜索
- [ ] 会话列表

### 高级功能 ✅
- [ ] 消息分页
- [ ] 已读状态
- [ ] 时间显示
- [ ] 权限控制
- [ ] 错误处理
- [ ] 界面响应

### 用户体验 ✅
- [ ] 界面美观
- [ ] 操作流畅
- [ ] 反馈及时
- [ ] 信息清晰
- [ ] 导航简单
- [ ] 错误友好

## 常见问题排查

### 1. 消息发送失败
- 检查网络连接
- 验证用户登录状态
- 确认后端服务运行
- 查看控制台错误日志

### 2. 会话不显示
- 检查API响应
- 验证用户权限
- 确认数据库连接
- 查看后端日志

### 3. 搜索功能异常
- 确认搜索参数
- 验证用户角色
- 检查搜索权限
- 查看搜索结果

### 4. 界面显示问题
- 检查样式文件
- 验证组件导入
- 确认状态管理
- 查看渲染逻辑

## 性能测试建议

### 1. 消息加载性能
- 测试大量消息的加载速度
- 验证分页加载效果
- 检查内存使用情况

### 2. 实时通信性能
- 测试消息发送延迟
- 验证多用户并发
- 检查服务器负载

### 3. 界面渲染性能
- 测试长列表滚动
- 验证动画流畅性
- 检查内存泄漏

## 测试报告模板

```markdown
# 聊天功能测试报告

## 测试环境
- 前端版本：[版本号]
- 后端版本：[版本号]
- 测试设备：[设备信息]
- 测试时间：[测试日期]

## 测试结果
- 基本功能：[通过/失败]
- 高级功能：[通过/失败]
- 用户体验：[通过/失败]

## 发现问题
1. [问题描述]
2. [问题描述]

## 改进建议
1. [建议内容]
2. [建议内容]
```

## 后续改进计划

### 短期改进
- [ ] 添加消息撤回功能
- [ ] 支持图片消息
- [ ] 添加消息提醒
- [ ] 优化界面样式

### 长期改进
- [ ] 支持语音消息
- [ ] 添加视频通话
- [ ] 实现群聊功能
- [ ] 集成AI助手

---

*此测试指南将随着功能更新持续维护* 